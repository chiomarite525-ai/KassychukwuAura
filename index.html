<script>
    // Your provided API Key
    const API_KEY = "AIzaSyD8AEL1VHkSy8zNnyVeOslO2QPdoG84Yys"; 
    let bookData = "";

    async function runAura() {
        const prompt = document.getElementById('userInput').value;
        if(!prompt) return alert("What should I write about, friend?");

        const btn = document.getElementById('genBtn');
        const originalText = btn.innerText;
        btn.innerText = "AURA IS CONNECTING...";
        btn.disabled = true;

        try {
            // Using the Google Generative AI Fetch URL
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${API_KEY}`;
            
            const response = await fetch(url, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    contents: [{
                        parts: [{
                            text: `Write a beautiful, long book about ${prompt}. 
                            INSTRUCTIONS: 
                            1. Act as a close friend. 
                            2. Use multiple chapters. 
                            3. Ensure the tone is personal and undetectable as AI.
                            4. End with 'This work is digitally protected by Kassy Chukwu Aura'.`
                        }]
                    }]
                })
            });

            const data = await response.json();

            // If Google returns an error, show exactly what it is
            if (data.error) {
                if(data.error.status === "INVALID_ARGUMENT") {
                    throw new Error("API Key is incorrect or invalid.");
                } else if(data.error.message.includes("API key not found")) {
                    throw new Error("API Key not found. Please check AI Studio.");
                } else {
                    throw new Error(data.error.message);
                }
            }

            // Successfully received the book content
            bookData = data.candidates[0].content.parts[0].text;

            // THE REVEAL: Fill the 4K Showroom
            document.getElementById('finalTitle').innerText = "THE POWER OF " + prompt.toUpperCase();
            document.getElementById('frontCover').innerText = "THE POWER OF " + prompt.toUpperCase();
            document.getElementById('bookContent').innerText = bookData;
            
            // Show the 4K Showroom Overlay
            document.getElementById('showroomOverlay').style.display = 'flex';

        } catch (e) {
            console.error("Aura Debug:", e);
            alert("Aura Connection Error: " + e.message + "\n\nTip: Make sure your internet is on and the API key is active in Google AI Studio.");
        } finally {
            btn.innerText = originalText;
            btn.disabled = false;
        }
    }

    function processFace(input) {
        if (input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = (e) => {
                document.getElementById('navAvatar').src = e.target.result;
                document.getElementById('showroomAvatar').src = e.target.result;
            };
            reader.readAsDataURL(input.files[0]);
        }
    }

    function toggleReader() {
        document.getElementById('readerDrawer').classList.toggle('hidden');
    }

    function closeShow() {
        document.getElementById('showroomOverlay').style.display = 'none';
        document.getElementById('readerDrawer').classList.add('hidden');
    }
</script>
